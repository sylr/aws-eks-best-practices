
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.2">
    
    
      
        <title>Expenditure awareness - EKS Best Practices Guides</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f955dcd.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#expenditure-awareness" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EKS Best Practices Guides" class="md-header__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EKS Best Practices Guides
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Expenditure awareness
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/aws/aws-eks-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EKS Best Practices Guides" class="md-nav__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EKS Best Practices Guides
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws/aws-eks-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Security
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/" class="md-nav__link">
        Home
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/iam/" class="md-nav__link">
        Identity and Access Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/pods/" class="md-nav__link">
        Pod Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/multitenancy/" class="md-nav__link">
        Multi-tenancy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/detective/" class="md-nav__link">
        Detective Controls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/network/" class="md-nav__link">
        Network Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/data/" class="md-nav__link">
        Data Encryption and Secrets Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/runtime/" class="md-nav__link">
        Runtime Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/hosts/" class="md-nav__link">
        Infrastructure Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/compliance/" class="md-nav__link">
        Regulatory Compliance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/incidents/" class="md-nav__link">
        Incident Response and Forensics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../security/docs/image/" class="md-nav__link">
        Image Security
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Cluster Autoscaling
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Cluster Autoscaling" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Cluster Autoscaling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster-autoscaling/cluster-autoscaling/" class="md-nav__link">
        Home
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Reliability
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reliability" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reliability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reliability/docs/" class="md-nav__link">
        Home
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reliability/docs/application/" class="md-nav__link">
        Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reliability/docs/controlplane/" class="md-nav__link">
        Control Plane
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reliability/docs/dataplane/" class="md-nav__link">
        Data Plane
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reliability/docs/networkmanagement/" class="md-nav__link">
        Network
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cost-explorer" class="md-nav__link">
    Use Cost Explorer
  </a>
  
    <nav class="md-nav" aria-label="Use Cost Explorer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eks-control-plane-and-eks-fargate-costs" class="md-nav__link">
    EKS Control Plane and EKS Fargate costs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagging-of-resources" class="md-nav__link">
    Tagging of Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-aws-trusted-advisor" class="md-nav__link">
    Use AWS Trusted Advisor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-the-kubernetes-dashboard" class="md-nav__link">
    Use the Kubernetes dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cloudwatch-container-insights" class="md-nav__link">
    Use CloudWatch Container Insights
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-kubecost-for-expenditure-awareness-and-guidance" class="md-nav__link">
    Using KubeCost for expenditure awareness and guidance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-kubernetes-cost-allocation-and-capacity-planning-analytics-tool" class="md-nav__link">
    Use Kubernetes Cost Allocation and Capacity Planning Analytics Tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magalix-kubeadvisor" class="md-nav__link">
    Magalix Kubeadvisor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotio-previously-called-spotinst" class="md-nav__link">
    Spot.io, previously called Spotinst
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yotascale" class="md-nav__link">
    Yotascale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alcide-advisor" class="md-nav__link">
    Alcide Advisor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-tools" class="md-nav__link">
    Other tools
  </a>
  
    <nav class="md-nav" aria-label="Other tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-garbage-collection" class="md-nav__link">
    Kubernetes Garbage Collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fargate-count" class="md-nav__link">
    Fargate count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-ops-view" class="md-nav__link">
    Kubernetes Ops View
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#popeye-a-kubernetes-cluster-sanitizer" class="md-nav__link">
    Popeye - A Kubernetes Cluster Sanitizer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws/aws-eks-best-practices/edit/master/docs/cost_optimization/awareness.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="expenditure-awareness">Expenditure awareness<a class="headerlink" href="#expenditure-awareness" title="Permanent link">&para;</a></h1>
<p>Expenditure awareness is understanding who, where and what is causing expenditures in your EKS cluster. Getting an accurate picture of this data will help raise awareness of your spend and highlight areas to remediate.</p>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<h3 id="use-cost-explorer">Use Cost Explorer<a class="headerlink" href="#use-cost-explorer" title="Permanent link">&para;</a></h3>
<p><a href="https://aws.amazon.com/aws-cost-management/aws-cost-explorer/">AWS Cost Explorer</a> has an easy-to-use interface that lets you visualize, understand, and manage your AWS costs and usage over time. You can analyze cost and usage data, at various levels using the filters available in Cost Explorer.</p>
<h4 id="eks-control-plane-and-eks-fargate-costs">EKS Control Plane and EKS Fargate costs<a class="headerlink" href="#eks-control-plane-and-eks-fargate-costs" title="Permanent link">&para;</a></h4>
<p>Using the filters, we can query the costs incurred for the EKS costs at the Control Plane and Fargate Pod as shown in the diagram below:</p>
<p><img alt="Cost Explorer - EKS Control Plane" src="../../images/eks-controlplane-costexplorer.png" /></p>
<p>Using the filters, we can query the aggregate costs incurred for the Fargate Pods across regions in EKS - which includes both vCPU-Hours per CPU and GB Hrs as shown in the diagram below:</p>
<p><img alt="Cost Explorer - EKS Fargate" src="../../images/eks-fargate-costexplorer.png" /></p>
<h4 id="tagging-of-resources">Tagging of Resources<a class="headerlink" href="#tagging-of-resources" title="Permanent link">&para;</a></h4>
<p>Amazon EKS supports <a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-using-tags.html">adding AWS tags</a> to your Amazon EKS clusters. This makes it easy to control access to the EKS API for managing your clusters. Tags added to an EKS cluster are specific to the AWS EKS cluster resource, they do not propagate to other AWS resources used by the cluster such as EC2 instances or load balancers. Today, cluster tagging is supported for all new and existing EKS clusters via the AWS API, Console, and SDKs.</p>
<p>AWS Fargate is a technology that provides on-demand, right-sized compute capacity for containers. Before you can schedule pods on Fargate in your cluster, you must define at least one Fargate profile that specifies which pods should use Fargate when they are launched. </p>
<p>Adding and Listing tags to an EKS cluster:</p>
<div class="codehilite"><pre><span></span><code>$ aws eks tag-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1 --tags <span class="nv">team</span><span class="o">=</span>devops,env<span class="o">=</span>staging,bu<span class="o">=</span>cio,costcenter<span class="o">=</span><span class="m">1234</span>
$ aws eks list-tags-for-resource --resource-arn arn:aws:eks:us-west-2:xxx:cluster/ekscluster1
<span class="o">{</span>
    <span class="s2">&quot;tags&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;bu&quot;</span>: <span class="s2">&quot;cio&quot;</span>,
        <span class="s2">&quot;env&quot;</span>: <span class="s2">&quot;staging&quot;</span>,
        <span class="s2">&quot;costcenter&quot;</span>: <span class="s2">&quot;1234&quot;</span>,
        <span class="s2">&quot;team&quot;</span>: <span class="s2">&quot;devops&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p>After you activate cost allocation tags in the <a href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-alloc-tags.html">AWS Cost Explorer</a>, AWS uses the cost allocation tags to organize your resource costs on your cost allocation report, to make it easier for you to categorize and track your AWS costs.</p>
<p>Tags don't have any semantic meaning to Amazon EKS and are interpreted strictly as a string of characters. For example, you can define a set of tags for your Amazon EKS clusters to help you track each cluster's owner and stack level.</p>
<h3 id="use-aws-trusted-advisor">Use AWS Trusted Advisor<a class="headerlink" href="#use-aws-trusted-advisor" title="Permanent link">&para;</a></h3>
<p>AWS Trusted Advisor offers a rich set of best practice checks and recommendations across five categories: cost optimization; security; fault tolerance; performance; and service limits.</p>
<p>For Cost Optimization, Trusted Advisor helps eliminate unused and idle resources and recommends making commitments to reserved capacity. The key action items that will help Amazon EKS will be around low utilsed EC2 instances, unassociated Elastic IP addresses, Idle Load Balancers, underutilized EBS volumes among other things. The complete list of checks are provided at https://aws.amazon.com/premiumsupport/technology/trusted-advisor/best-practice-checklist/. </p>
<p>The Trusted Advisor also provides Savings Plans and Reserved Instances recommendations for EC2 instances and Fargate which allows you to commit to a consistent usage amount in exchange for discounted rates. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>that the recommendations from Trusted Advisor are generic recommendations and not specific to EKS. </p>
</div>
<h3 id="use-the-kubernetes-dashboard">Use the Kubernetes dashboard<a class="headerlink" href="#use-the-kubernetes-dashboard" title="Permanent link">&para;</a></h3>
<p><strong><em>Kubernetes dashboard</em></strong></p>
<p>Kubernetes Dashboard is a general purpose, web-based UI for Kubernetes clusters, which provides information about the Kubernetes cluster including the resource usage at a cluster, node and pod level. The deployment of the Kubernetes dashboard on an Amazon EKS cluster is described in the <a href="https://docs.aws.amazon.com/eks/latest/userguide/dashboard-tutorial.html">Amazon EKS documentation</a>. </p>
<p>Dashboard provides resource usage breakdowns for each node and pod, as well as detailed metadata about pods, services, Deployments, and other Kubernetes objects. This consolidated information provides visibility into your Kubernetes environment.</p>
<p><img alt="Kubernetes Dashboard" src="../../images/kubernetes-dashboard.png" /></p>
<p><strong><em>kubectl top and describe commands</em></strong></p>
<p>Viewing resource usage metrics with kubectl top and kubectl describe commands. kubectl top will show current CPU and memory usage for the pods or nodes across your cluster, or for a specific pod or node. The kubectl describe command will give more detailed information about a specific node or a pod.</p>
<div class="codehilite"><pre><span></span><code>$ kubectl top pods
$ kubectl top nodes
$ kubectl top pod pod-name --namespace mynamespace --containers
</code></pre></div>

<p>Using the top command, the output will displays the total amount of CPU (in cores) and memory (in MiB) that the node is using, and the percentages of the node’s allocatable capacity those numbers represent. You can then drill-down to the next level, container level within pods by adding a <em>--containers</em> flag. </p>
<div class="codehilite"><pre><span></span><code>$ kubectl describe node &lt;node&gt;
$ kubectl describe pod &lt;pod&gt;
</code></pre></div>

<p><em>kubectl describe</em> returns the percent of total available capacity that each resource request or limit represents. </p>
<p>kubectl top and describe, track the utilization and availability of critical resources such as CPU, memory, and storage across kubernetes pods, nodes and containers. This awareness will help in understanding resource usage and help in controlling costs. </p>
<h3 id="use-cloudwatch-container-insights">Use CloudWatch Container Insights<a class="headerlink" href="#use-cloudwatch-container-insights" title="Permanent link">&para;</a></h3>
<p>Use <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html">CloudWatch Container Insights</a> to collect, aggregate, and summarize metrics and logs from your containerized applications and microservices. Container Insights is available for Amazon Elastic Kubernetes Service on EC2, and Kubernetes platforms on Amazon EC2. The metrics include utilization for resources such as CPU, memory, disk, and network. </p>
<p>The installation of insights is given in the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html">documentation</a>.</p>
<p>CloudWatch creates aggregated metrics at the cluster, node, pod, task, and service level as CloudWatch metrics. </p>
<p><strong>The following query shows a list of nodes, sorted by average node CPU utilization</strong></p>
<div class="codehilite"><pre><span></span><code>STATS avg(node_cpu_utilization) as avg_node_cpu_utilization by NodeName
| SORT avg_node_cpu_utilization DESC 
</code></pre></div>

<p><strong>CPU usage by Container name</strong></p>
<div class="codehilite"><pre><span></span><code>stats pct(container_cpu_usage_total, 50) as CPUPercMedian by kubernetes.container_name 
| filter Type=&quot;Container&quot;
</code></pre></div>

<p><strong>Disk usage by Container name</strong></p>
<div class="codehilite"><pre><span></span><code>stats floor(avg(container_filesystem_usage/1024)) as container_filesystem_usage_avg_kb by InstanceId, kubernetes.container_name, device 
| filter Type=&quot;ContainerFS&quot; 
| sort container_filesystem_usage_avg_kb desc
</code></pre></div>

<p>More sample queries are given in the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Container-Insights-view-metrics.html">Container Insights documention</a></p>
<p>This awareness will help in understanding resource usage and help in controlling costs.</p>
<h3 id="using-kubecost-for-expenditure-awareness-and-guidance">Using KubeCost for expenditure awareness and guidance<a class="headerlink" href="#using-kubecost-for-expenditure-awareness-and-guidance" title="Permanent link">&para;</a></h3>
<p>Third party tools like <a href="https://kubecost.com/">kubecost</a> can also be deployed on Amazon EKS to get visibility into cost of running your Kubernetes cluster. Please refer to this <a href="https://aws.amazon.com/blogs/containers/how-to-track-costs-in-multi-tenant-amazon-eks-clusters-using-kubecost/">AWS blog</a> for tracking costs using Kubecost</p>
<p>Deploying kubecost using Helm 3:</p>
<div class="codehilite"><pre><span></span><code>$ <span class="n">curl</span> -<span class="n">sSL</span> <span class="n">https:</span>//<span class="nb">raw</span>.<span class="n">githubusercontent</span>.<span class="n">com</span><span class="o">/</span><span class="n">helm</span><span class="o">/</span><span class="n">helm</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">get-helm-3</span> | <span class="n">bash</span>
$ <span class="n">helm</span> <span class="nb">version</span> --<span class="n">short</span>
<span class="n">v3</span><span class="mf">.2.1</span><span class="o">+</span><span class="n">gfe51cd1</span>
$ <span class="n">helm</span> <span class="n">repo</span> <span class="nb">add</span> <span class="nb">stable</span> <span class="n">https:</span>//<span class="n">kubernetes-charts</span>.<span class="n">storage</span>.<span class="n">googleapis</span>.<span class="n">com</span>/
$ <span class="n">helm</span> <span class="n">repo</span> <span class="nb">add</span> <span class="nb">stable</span> <span class="n">https:</span>//<span class="n">kubernetes-charts</span>.<span class="n">storage</span>.<span class="n">googleapis</span>.<span class="n">com</span><span class="o">/</span><span class="n">c</span><span class="o">^</span><span class="n">C</span>
$ <span class="n">kubectl</span> <span class="n">create</span> <span class="n">namespace</span> <span class="n">kubecost</span> 
<span class="n">namespace</span><span class="o">/</span><span class="n">kubecost</span> <span class="n">created</span>
$ <span class="n">helm</span> <span class="n">repo</span> <span class="nb">add</span> <span class="n">kubecost</span> <span class="n">https:</span>//<span class="n">kubecost</span>.<span class="n">github</span>.<span class="n">io</span><span class="o">/</span><span class="n">cost-analyzer</span>/ 
<span class="s">&quot;kubecost&quot;</span> <span class="k">has</span> <span class="n">been</span> <span class="n">added</span> <span class="nb">to</span> <span class="n">your</span> <span class="n">repositories</span>

$ <span class="n">helm</span> <span class="n">install</span> <span class="n">kubecost</span> <span class="n">kubecost</span><span class="o">/</span><span class="n">cost-analyzer</span> --<span class="n">namespace</span> <span class="n">kubecost</span> --<span class="n">set</span> <span class="n">kubecostToken</span>=<span class="s">&quot;aGRoZEBqc2pzLmNvbQ==xm343yadf98&quot;</span>
<span class="n">NAME:</span> <span class="n">kubecost</span>
<span class="k">LAST</span> <span class="n">DEPLOYED:</span> <span class="n">Mon</span> <span class="n">May</span> <span class="mi">18</span> <span class="mi">08</span>:<span class="mi">49</span>:<span class="mo">05</span> <span class="mi">2020</span>
<span class="n">NAMESPACE:</span> <span class="n">kubecost</span>
<span class="n">STATUS:</span> <span class="n">deployed</span>
<span class="n">REVISION:</span> <span class="mi">1</span>
<span class="n">TEST</span> <span class="n">SUITE:</span> <span class="n">None</span>
<span class="n">NOTES:</span>
--------------------------------------------------<span class="n">Kubecost</span> <span class="k">has</span> <span class="n">been</span> <span class="n">successfully</span> <span class="n">installed</span>. <span class="n">When</span> <span class="n">pods</span> <span class="n">are</span> <span class="n">Ready</span>, <span class="n">you</span> <span class="nb">can</span> <span class="n">enable</span> <span class="n">port-forwarding</span> <span class="k">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">command:</span>

    <span class="n">kubectl</span> <span class="n">port-forward</span> --<span class="n">namespace</span> <span class="n">kubecost</span> <span class="n">deployment</span><span class="o">/</span><span class="n">kubecost-cost-analyzer</span> <span class="mi">9090</span>

<span class="n">Next</span>, <span class="n">navigate</span> <span class="nb">to</span> <span class="n">http:</span>//<span class="n">localhost:9090</span> <span class="nb">in</span> <span class="n">a</span> <span class="n">web</span> <span class="n">browser</span>.
$ <span class="n">kubectl</span> <span class="n">port-forward</span> --<span class="n">namespace</span> <span class="n">kubecost</span> <span class="n">deployment</span><span class="o">/</span><span class="n">kubecost-cost-analyzer</span> <span class="mi">9090</span>

<span class="n">Note:</span> <span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">using</span> <span class="n">Cloud</span> <span class="mi">9</span> <span class="o">or</span> <span class="n">have</span> <span class="n">a</span> <span class="k">need</span> <span class="nb">to</span> <span class="n">forward</span> <span class="n">it</span> <span class="nb">to</span> <span class="n">a</span> <span class="n">different</span> <span class="n">port</span> <span class="nb">like</span> <span class="mi">8080</span>, <span class="n">issue</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">command</span>
$ <span class="n">kubectl</span> <span class="n">port-forward</span> --<span class="n">namespace</span> <span class="n">kubecost</span> <span class="n">deployment</span><span class="o">/</span><span class="n">kubecost-cost-analyzer</span> <span class="mi">8080</span>:<span class="mi">9090</span>
</code></pre></div>

<p>Kube Cost Dashboard -
<img alt="Kubernetes Cluster Auto Scaler logs" src="../../images/kube-cost.png" /></p>
<h3 id="use-kubernetes-cost-allocation-and-capacity-planning-analytics-tool">Use Kubernetes Cost Allocation and Capacity Planning Analytics Tool<a class="headerlink" href="#use-kubernetes-cost-allocation-and-capacity-planning-analytics-tool" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/rchakode/kube-opex-analytics">Kubernetes Opex Analytics</a> is a tool to help organizations track the resources being consumed by their Kubernetes clusters to prevent overpaying. To do so it generates, short- (7 days), mid- (14 days) and long-term (12 months) usage reports showing relevant insights on what amount of resources each project is spending over time. </p>
<p><img alt="Kubernetes Opex Analytics" src="../../images/kube-opex-analytics.png" /></p>
<h3 id="magalix-kubeadvisor">Magalix Kubeadvisor<a class="headerlink" href="#magalix-kubeadvisor" title="Permanent link">&para;</a></h3>
<p><a href="https://www.magalix.com/kubeadvisor">KubeAdvisor</a> continuously scans your Kubernetes clusters and reports how you can fix issues, apply best practices, and optimize your cluster (with recommendations of resources like CPU/Memory around cost-efficiency).</p>
<h3 id="spotio-previously-called-spotinst">Spot.io, previously called Spotinst<a class="headerlink" href="#spotio-previously-called-spotinst" title="Permanent link">&para;</a></h3>
<p>Spotinst Ocean is an application scaling service. Similar to Amazon Elastic Compute Cloud (Amazon EC2) Auto Scaling groups, Spotinst Ocean is designed to optimize performance and costs by leveraging Spot Instances combined with On-Demand and Reserved Instances. Using a combination of automated Spot Instance management and the variety of instance sizes, the Ocean cluster autoscaler scales according to the pod resource requirements. Spotinst Ocean also includes a prediction algorithm to predict Spot Instance interruption 15 minutes ahead of time and spin up a new node in a different Spot capacity pool.</p>
<p>This is available as an <a href="https://aws.amazon.com/quickstart/architecture/spotinst-ocean-eks/">AWS Quickstart</a> developed by Spotinst, Inc. in collaboration with AWS. </p>
<p>The EKS workshop also has a module on <a href="https://eksworkshop.com/beginner/190_ocean/">Optimized Worker Node on Amazon EKS Management</a> with Ocean by Spot.io which includes sections on cost allocation, right sizing and scaling strategies.</p>
<h3 id="yotascale">Yotascale<a class="headerlink" href="#yotascale" title="Permanent link">&para;</a></h3>
<p>Yotascale helps with accurately allocating Kubernetes costs. Yotascale Kubernetes Cost Allocation feature utilizes actual cost data, which is inclusive of Reserved Instance discounts and spot instance pricing instead of generic market-rate estimations, to inform the total Kubernetes cost footprint</p>
<p>More details can be found at <a href="https://www.yotascale.com/">their website</a>.</p>
<h3 id="alcide-advisor">Alcide Advisor<a class="headerlink" href="#alcide-advisor" title="Permanent link">&para;</a></h3>
<p>Alcide is an AWS Partner Network (APN) Advanced Technology Partner. Alcide Advisor helps ensure your Amazon EKS cluster, nodes, and pods configuration are tuned to run according to security best practices and internal guidelines. Alcide Advisor is an agentless service for Kubernetes audit and compliance that’s built to ensure a frictionless and secured DevSecOps flow by hardening the development stage before moving to production.</p>
<p>More details can be found in this <a href="https://aws.amazon.com/blogs/apn/driving-continuous-security-and-configuration-checks-for-amazon-eks-with-alcide-advisor/">blog post</a>.</p>
<h2 id="other-tools">Other tools<a class="headerlink" href="#other-tools" title="Permanent link">&para;</a></h2>
<h3 id="kubernetes-garbage-collection">Kubernetes Garbage Collection<a class="headerlink" href="#kubernetes-garbage-collection" title="Permanent link">&para;</a></h3>
<p>The role of the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/garbage-collection/">Kubernetes garbage collector</a> is to delete certain objects that once had an owner, but no longer have an owner.</p>
<h3 id="fargate-count">Fargate count<a class="headerlink" href="#fargate-count" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/mreferre/fargatecount">Fargatecount</a> is an useful tool, which allows AWS customers to track, with a custom CloudWatch metric, the total number of EKS pods that have been deployed on Fargate in a specific region of a specific account. This helps in keeping track of all the Fargate pods running across an EKS cluster.</p>
<h3 id="kubernetes-ops-view">Kubernetes Ops View<a class="headerlink" href="#kubernetes-ops-view" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/hjacobs/kube-ops-view">Kube Ops View</a> is an useful tool, which provides a common operational picture visually for multiple Kubernetes clusters.</p>
<div class="codehilite"><pre><span></span><code>git clone https://github.com/hjacobs/kube-ops-view
cd kube-ops-view
kubectl apply -k deploy/
</code></pre></div>

<p><img alt="Home Page" src="../../images/kube-ops-report.png" /></p>
<h3 id="popeye-a-kubernetes-cluster-sanitizer">Popeye - A Kubernetes Cluster Sanitizer<a class="headerlink" href="#popeye-a-kubernetes-cluster-sanitizer" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/derailed/popeye">Popeye - A Kubernetes Cluster Sanitizer</a> is a utility that scans live Kubernetes cluster and reports potential issues with deployed resources and configurations. It sanitizes your cluster based on what's deployed and not what's sitting on disk. By scanning your cluster, it detects misconfigurations and helps you to ensure that best practices are in place</p>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<p>Refer to the following resources to learn more about best practices for cost optimization.</p>
<p>Documentation and Blogs
+   <a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-using-tags.html">Amazon EKS supports tagging</a></p>
<p>Tools
+   <a href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-alloc-tags.html">What is AWS Billing and Cost Management?</a>
+   <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html">Amazon CloudWatch Container Insights</a>
+   <a href="https://aws.amazon.com/blogs/containers/how-to-track-costs-in-multi-tenant-amazon-eks-clusters-using-kubecost/">How to track costs in multi-tenant Amazon EKS clusters using Kubecost</a> 
+   <a href="https://kubecost.com/">Kube Cost</a>
+   <a href="https://github.com/hjacobs/kube-ops-view">Kube Opsview</a>
+  <a href="https://github.com/hjacobs/kube-janitor">Kube Janitor</a>
+  <a href="https://github.com/rchakode/kube-opex-analytics">Kubernetes Opex Analytics</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>