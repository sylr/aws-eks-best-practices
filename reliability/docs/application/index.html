
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.2">
    
    
      
        <title>Applications - EKS Best Practices Guides</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f955dcd.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-highly-available-applications" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="EKS Best Practices Guides" class="md-header__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EKS Best Practices Guides
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Applications
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/aws/aws-eks-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="EKS Best Practices Guides" class="md-nav__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EKS Best Practices Guides
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws/aws-eks-best-practices/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Security
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/" class="md-nav__link">
        Home
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/iam/" class="md-nav__link">
        Identity and Access Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/pods/" class="md-nav__link">
        Pod Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/multitenancy/" class="md-nav__link">
        Multi-tenancy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/detective/" class="md-nav__link">
        Detective Controls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/network/" class="md-nav__link">
        Network Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/data/" class="md-nav__link">
        Data Encryption and Secrets Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/runtime/" class="md-nav__link">
        Runtime Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/hosts/" class="md-nav__link">
        Infrastructure Security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/compliance/" class="md-nav__link">
        Regulatory Compliance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/incidents/" class="md-nav__link">
        Incident Response and Forensics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/image/" class="md-nav__link">
        Image Security
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Cluster Autoscaling
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Cluster Autoscaling" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Cluster Autoscaling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../cluster-autoscaling/cluster-autoscaling/" class="md-nav__link">
        Home
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Reliability
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reliability" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reliability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Home
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Applications
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avoid-running-singleton-pods" class="md-nav__link">
    Avoid running singleton Pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-multiple-replicas" class="md-nav__link">
    Run multiple replicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schedule-replicas-across-nodes" class="md-nav__link">
    Schedule replicas across nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-kubernetes-metrics-server" class="md-nav__link">
    Run Kubernetes Metrics Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-pod-autoscaler-hpa" class="md-nav__link">
    Horizontal Pod Autoscaler (HPA)
  </a>
  
    <nav class="md-nav" aria-label="Horizontal Pod Autoscaler (HPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaling-applications-based-on-custom-or-external-metrics" class="md-nav__link">
    Scaling applications based on custom or external metrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vertical-pod-autoscaler-vpa" class="md-nav__link">
    Vertical Pod Autoscaler (VPA)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-applications" class="md-nav__link">
    Updating applications
  </a>
  
    <nav class="md-nav" aria-label="Updating applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#have-a-mechanism-to-perform-rollbacks" class="md-nav__link">
    Have a mechanism to perform rollbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-bluegreen-deployments" class="md-nav__link">
    Use blue/green deployments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-canary-deployments" class="md-nav__link">
    Use Canary deployments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-checks-and-self-healing" class="md-nav__link">
    Health checks and self-healing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_1" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-liveness-probe-to-remove-unhealthy-pods" class="md-nav__link">
    Use Liveness Probe to remove unhealthy pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-startup-probe-for-applications-that-take-longer-to-start" class="md-nav__link">
    Use Startup Probe for applications that take longer to start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-readiness-probe-to-detect-partial-unavailability" class="md-nav__link">
    Use Readiness Probe to detect partial unavailability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-disruptions" class="md-nav__link">
    Dealing with disruptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_2" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protect-critical-workload-with-pod-disruption-budgets" class="md-nav__link">
    Protect critical workload with Pod Disruption Budgets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practice-chaos-engineering" class="md-nav__link">
    Practice chaos engineering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-service-mesh" class="md-nav__link">
    Use a Service Mesh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-meshes" class="md-nav__link">
    Service Meshes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observability" class="md-nav__link">
    Observability
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_3" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monitor-your-applications" class="md-nav__link">
    Monitor your applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-prometheus-client-library-to-expose-application-metrics" class="md-nav__link">
    Use Prometheus client library to expose application metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-centralized-logging-tools-to-collect-and-persist-logs" class="md-nav__link">
    Use centralized logging tools to collect and persist logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-distributed-tracing-system-to-identify-bottlenecks" class="md-nav__link">
    Use a distributed tracing system to identify bottlenecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../controlplane/" class="md-nav__link">
        Control Plane
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dataplane/" class="md-nav__link">
        Data Plane
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../networkmanagement/" class="md-nav__link">
        Network
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avoid-running-singleton-pods" class="md-nav__link">
    Avoid running singleton Pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-multiple-replicas" class="md-nav__link">
    Run multiple replicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schedule-replicas-across-nodes" class="md-nav__link">
    Schedule replicas across nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-kubernetes-metrics-server" class="md-nav__link">
    Run Kubernetes Metrics Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#horizontal-pod-autoscaler-hpa" class="md-nav__link">
    Horizontal Pod Autoscaler (HPA)
  </a>
  
    <nav class="md-nav" aria-label="Horizontal Pod Autoscaler (HPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scaling-applications-based-on-custom-or-external-metrics" class="md-nav__link">
    Scaling applications based on custom or external metrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vertical-pod-autoscaler-vpa" class="md-nav__link">
    Vertical Pod Autoscaler (VPA)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-applications" class="md-nav__link">
    Updating applications
  </a>
  
    <nav class="md-nav" aria-label="Updating applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#have-a-mechanism-to-perform-rollbacks" class="md-nav__link">
    Have a mechanism to perform rollbacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-bluegreen-deployments" class="md-nav__link">
    Use blue/green deployments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-canary-deployments" class="md-nav__link">
    Use Canary deployments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-checks-and-self-healing" class="md-nav__link">
    Health checks and self-healing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_1" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-liveness-probe-to-remove-unhealthy-pods" class="md-nav__link">
    Use Liveness Probe to remove unhealthy pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-startup-probe-for-applications-that-take-longer-to-start" class="md-nav__link">
    Use Startup Probe for applications that take longer to start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-readiness-probe-to-detect-partial-unavailability" class="md-nav__link">
    Use Readiness Probe to detect partial unavailability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-disruptions" class="md-nav__link">
    Dealing with disruptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_2" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protect-critical-workload-with-pod-disruption-budgets" class="md-nav__link">
    Protect critical workload with Pod Disruption Budgets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practice-chaos-engineering" class="md-nav__link">
    Practice chaos engineering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-service-mesh" class="md-nav__link">
    Use a Service Mesh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-meshes" class="md-nav__link">
    Service Meshes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observability" class="md-nav__link">
    Observability
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_3" class="md-nav__link">
    Recommendations
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monitor-your-applications" class="md-nav__link">
    Monitor your applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-prometheus-client-library-to-expose-application-metrics" class="md-nav__link">
    Use Prometheus client library to expose application metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-centralized-logging-tools-to-collect-and-persist-logs" class="md-nav__link">
    Use centralized logging tools to collect and persist logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-distributed-tracing-system-to-identify-bottlenecks" class="md-nav__link">
    Use a distributed tracing system to identify bottlenecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws/aws-eks-best-practices/edit/master/docs/reliability/docs/application.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="running-highly-available-applications">Running highly-available applications<a class="headerlink" href="#running-highly-available-applications" title="Permanent link">&para;</a></h1>
<p>Your customers expect your application to be always available, including when you're making changes and especially during spikes in traffic. A scalable and resilient architecture keeps your applications and services running without disruptions, which keeps your users happy. A scalable infrastructure grows and shrinks based on the needs of the business. Eliminating single points of failure is a critical step towards improving an application’s availability and making it resilient.</p>
<p>With Kubernetes, you can operate your applications and run them in a highly-available and resilient fashion. Its declarative management ensures that once you’ve set up the application, Kubernetes will continuously try to <a href="https://kubernetes.io/docs/concepts/architecture/controller/#desired-vs-current">match the current state with the desired state</a>.</p>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<h3 id="avoid-running-singleton-pods">Avoid running singleton Pods<a class="headerlink" href="#avoid-running-singleton-pods" title="Permanent link">&para;</a></h3>
<p>If your entire application runs in a single Pod, then your application will be unavailable if that Pod gets terminated. Instead of deploying applications using individual pods, create <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployments</a>. If a Pod that is created by a Deployment fails or gets terminated, the Deployment <a href="https://kubernetes.io/docs/concepts/architecture/controller/">controller</a> will start a new pod to ensure the specified number of replica Pods are always running. </p>
<h3 id="run-multiple-replicas">Run multiple replicas<a class="headerlink" href="#run-multiple-replicas" title="Permanent link">&para;</a></h3>
<p>Running multiple replicas Pods of an app using a Deployment helps it run in a highly-available manner. If one replica fails, the remaining replicas will still function, albeit at reduced capacity until Kubernetes creates another Pod to make up for the loss. Furthermore, you can use the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a> to scale replicas automatically based on workload demand. </p>
<h3 id="schedule-replicas-across-nodes">Schedule replicas across nodes<a class="headerlink" href="#schedule-replicas-across-nodes" title="Permanent link">&para;</a></h3>
<p>Running multiple replicas won’t be very useful if all the replicas are running on the same node, and the node becomes unavailable. Consider using pod anti-affinity to spread replicas of a Deployment across multiple worker nodes. </p>
<p>You can further improve a typical application’s reliability by running it across multiple AZs. </p>
<p>The manifest below tells Kubernetes scheduler to <em>prefer</em> to place pods on separate nodes and AZs. It doesn’t require distinct nodes or AZ because if it did, then Kubernetes will not be able to schedule any pods once there is a pod running in each AZ. If your application requires just three replicas, you can use <code>requiredDuringSchedulingIgnoredDuringExecution</code> for <code>topologyKey: topology.kubernetes.io/zone</code>, and Kubernetes scheduler will not schedule two pods in the same AZ.</p>
<div class="codehilite"><pre><span></span><code><span class="n">piVersion</span><span class="o">:</span> <span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">Deployment</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">spread</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">az</span>
  <span class="n">labels</span><span class="o">:</span>
    <span class="n">app</span><span class="o">:</span> <span class="n">web</span><span class="o">-</span><span class="n">server</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">replicas</span><span class="o">:</span> <span class="mi">4</span>
  <span class="n">selector</span><span class="o">:</span>
    <span class="n">matchLabels</span><span class="o">:</span>
      <span class="n">app</span><span class="o">:</span> <span class="n">web</span><span class="o">-</span><span class="n">server</span>
  <span class="n">template</span><span class="o">:</span>
    <span class="n">metadata</span><span class="o">:</span>
      <span class="n">labels</span><span class="o">:</span>
        <span class="n">app</span><span class="o">:</span> <span class="n">web</span><span class="o">-</span><span class="n">server</span>
    <span class="n">spec</span><span class="o">:</span>
      <span class="n">affinity</span><span class="o">:</span>
        <span class="n">podAntiAffinity</span><span class="o">:</span>
          <span class="n">preferredDuringSchedulingIgnoredDuringExecution</span><span class="o">:</span>
          <span class="o">-</span> <span class="n">podAffinityTerm</span><span class="o">:</span>
              <span class="n">labelSelector</span><span class="o">:</span>
                <span class="n">matchExpressions</span><span class="o">:</span>
                <span class="o">-</span> <span class="n">key</span><span class="o">:</span> <span class="n">app</span>
                  <span class="n">operator</span><span class="o">:</span> <span class="n">In</span>
                  <span class="n">values</span><span class="o">:</span>
                  <span class="o">-</span> <span class="n">web</span><span class="o">-</span><span class="n">server</span>
              <span class="n">topologyKey</span><span class="o">:</span> <span class="n">topology</span><span class="o">.</span><span class="na">kubernetes</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">zone</span>
            <span class="n">weight</span><span class="o">:</span> <span class="mi">100</span>
          <span class="o">-</span> <span class="n">podAffinityTerm</span><span class="o">:</span>
              <span class="n">labelSelector</span><span class="o">:</span>
                <span class="n">matchExpressions</span><span class="o">:</span>
                <span class="o">-</span> <span class="n">key</span><span class="o">:</span> <span class="n">app</span>
                  <span class="n">operator</span><span class="o">:</span> <span class="n">In</span>
                  <span class="n">values</span><span class="o">:</span>
                  <span class="o">-</span> <span class="n">web</span><span class="o">-</span><span class="n">server</span>
              <span class="n">topologyKey</span><span class="o">:</span> <span class="n">kubernetes</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">hostname</span> 
            <span class="n">weight</span><span class="o">:</span> <span class="mi">99</span>
      <span class="n">containers</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">web</span><span class="o">-</span><span class="n">app</span>
        <span class="n">image</span><span class="o">:</span> <span class="n">nginx</span><span class="o">:</span><span class="mf">1.16</span><span class="o">-</span><span class="n">alpine</span>
</code></pre></div>

<p>In version 1.18, Kubernetes introduced <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/">pod topology spread constraints</a>, which allows you to spread Pods across AZs automatically.</p>
<h3 id="run-kubernetes-metrics-server">Run Kubernetes Metrics Server<a class="headerlink" href="#run-kubernetes-metrics-server" title="Permanent link">&para;</a></h3>
<p>Install the Kubernetes <a href="https://github.com/kubernetes-sigs/metrics-server">metrics server</a> to help scale your applications. Kubernetes autoscaler add-ons like <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">HPA</a> and <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">VPA</a> need to track metrics of applications to scale them. The metrics-server collects resource metrics that can be used to make scaling decisions. The metrics are collected from kubelets and served in <a href="https://github.com/kubernetes/metrics">Metrics API format</a>.</p>
<p>The metrics server doesn’t retain any data, and it’s not a monitoring solution. Its purpose is to expose CPU and memory usage metrics to other systems. If you want to track your application's state over time, you need a monitoring tool like Prometheus or Amazon CloudWatch. </p>
<p>Follow the <a href="https://docs.aws.amazon.com/eks/latest/userguide/metrics-server.html">EKS documentation</a> to install metrics-server in your EKS cluster. </p>
<h2 id="horizontal-pod-autoscaler-hpa">Horizontal Pod Autoscaler (HPA)<a class="headerlink" href="#horizontal-pod-autoscaler-hpa" title="Permanent link">&para;</a></h2>
<p>HPA can automatically scale your application in response to demand and help you avoid impacting your customers during peak traffic. It is implemented as a control loop in Kubernetes that periodically queries metrics from APIs that provide resource metrics.</p>
<p>HPA can retrieve metrics from the following APIs:
1. <code>metrics.k8s.io</code> also known as Resource Metrics API — Provides CPU and memory usage for pods
2. <code>custom.metrics.k8s.io</code> — Provides metrics from other metric collectors like Prometheus; these metrics are <strong>internal</strong> to your Kubernetes cluster. 
3. <code>external.metrics.k8s.io</code> — Provides metrics that are <strong>external</strong> to your Kubernetes cluster (E.g., SQS Queue Depth, ELB latency).</p>
<p>You must use one of these three APIs to provide the metric to scale your application. </p>
<h3 id="scaling-applications-based-on-custom-or-external-metrics">Scaling applications based on custom or external metrics<a class="headerlink" href="#scaling-applications-based-on-custom-or-external-metrics" title="Permanent link">&para;</a></h3>
<p>You can use custom or external metrics to scale your application on metrics other than CPU or memory utilization. <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/instrumentation/custom-metrics-api.md">Custom Metrics</a> API servers provide the <code>custom-metrics.k8s.io</code> API that HPA can use to autoscale applications. </p>
<p>You can use the <a href="https://github.com/directxman12/k8s-prometheus-adapter">Prometheus Adapter for Kubernetes Metrics APIs</a> to collect metrics from Prometheus and use with the HPA. In this case, Prometheus adapter will expose Prometheus metrics in <a href="https://github.com/kubernetes/metrics/blob/master/pkg/apis/metrics/v1alpha1/types.go">Metrics API format</a>. A list of all custom metrics implementation can be found in <a href="https://github.com/kubernetes/metrics/blob/master/IMPLEMENTATIONS.md#custom-metrics-api">Kubernetes Documentation</a>. </p>
<p>Once you deploy the Prometheus Adapter, you can query custom metrics using kubectl.
<code>kubectl get —raw /apis/custom.metrics.k8s.io/v1beta1/</code></p>
<p><a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/instrumentation/external-metrics-api.md">External metrics</a>, as the name suggests, provide the Horizontal Pod Autoscaler the ability to scale deployments using metrics that are external to the Kubernetes cluster. For example, in batch processing workloads, it is common to scale the number of replicas based on the number of jobs in flight in an SQS queue.</p>
<p>To autoscale a Deployment using a CloudWatch metric, for example, <a href="https://github.com/awslabs/k8s-cloudwatch-adapter/blob/master/samples/sqs/README.md">scaling a batch-processor application based on SQS queue depth</a>, you can use <a href="https://github.com/awslabs/k8s-cloudwatch-adapter"><code>k8s-cloudwatch-adapter</code></a>. <code>k8s-cloudwatch-adapter</code> is a community project and not maintained by AWS. </p>
<h2 id="vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler (VPA)<a class="headerlink" href="#vertical-pod-autoscaler-vpa" title="Permanent link">&para;</a></h2>
<p>VPA automatically adjusts the CPU and memory reservation for your Pods to help you “right-size” your applications. For applications that need to be scaled vertically - which is done by increasing resource allocation - you can use <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">VPA</a> to automatically scale Pod replicas or provide scaling recommendations.</p>
<p>Your application may become temporarily unavailable if VPA needs to scale it because VPA’s current implementation does not perform in-place adjustments to Pods; instead, it will recreate the Pod that needs to be scaled. </p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/vertical-pod-autoscaler.html">EKS Documentation</a> includes a walkthrough for setting up VPA. </p>
<p><a href="https://github.com/FairwindsOps/goldilocks/">Fairwinds Goldilocks</a> project provides a dashboard to visualize VPA recommendations for CPU and memory requests and limits. Its VPA update mode allows you to auto-scale Pods based on VPA recommendations. </p>
<h2 id="updating-applications">Updating applications<a class="headerlink" href="#updating-applications" title="Permanent link">&para;</a></h2>
<p>Modern applications require rapid innovation with a high degree of stability and availability. Kubernetes gives you the tools to update your applications continuously without disrupting your customers. </p>
<p>Let’s look at some of the best practices that make it possible to quickly deploy changes without sacrificing availability.</p>
<h3 id="have-a-mechanism-to-perform-rollbacks">Have a mechanism to perform rollbacks<a class="headerlink" href="#have-a-mechanism-to-perform-rollbacks" title="Permanent link">&para;</a></h3>
<p>Having an undo button can evade disasters. It is a best practice to test deployments in a separate lower environment (test or development environment) before updating the production cluster. Using a CI/CD pipeline can help you automate and test deployments. With a continuous deployment pipeline, you can quickly revert to the older version if the upgrade happens to be defective.  </p>
<p>You can use Deployments to update a running application. This is typically done by updating the container image. You can use <code>kubectl</code> to update a Deployment like this:</p>
<div class="codehilite"><pre><span></span><code>kubectl --record deployment.apps/nginx-deployment <span class="nb">set</span> image nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.16.1
</code></pre></div>

<p>The <code>--record</code> argument record the changes to the Deployment and helps you if you need to perform a rollback. <code>kubectl rollout history deployment</code> shows you the recorded changes to Deployments in your cluster. You can rollback a change using <code>kubectl rollout undo deployment &lt;DEPLOYMENT_NAME&gt;</code>.</p>
<p>By default, when you update a Deployment that requires a recreation of pods, Deployment will perform a <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/">rolling update</a>. In other words, Kubernetes will only update a portion of the running pods in a Deployment and not all the Pods at once. You can control how Kubernetes performs rolling updates through <code>RollingUpdateStrategy</code> property. </p>
<p>When performing a <em>rolling update</em> of a Deployment, you can use the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#max-unavailable"><code>Max Unavailable</code></a> property to specify the maximum number of Pods that can be unavailable during the update. The <code>Max Surge</code> property of Deployment allows you to set the maximum number of Pods that can be created over the desired number of Pods.</p>
<p>Consider adjusting <code>max unavailable</code> to ensure that a rollout doesn’t disrupt your customers. For example, Kubernetes sets 25% <code>max unavailable</code> by default, which means if you have 100 Pods, you may have only 75 Pods actively working during a rollout. If your application needs a minimum of 80 Pods, this rollout can be disruptive. Instead, you can set <code>max unavailable</code> to 20% to ensure that there are at least 80 functional Pods throughout the rollout. </p>
<h3 id="use-bluegreen-deployments">Use blue/green deployments<a class="headerlink" href="#use-bluegreen-deployments" title="Permanent link">&para;</a></h3>
<p>Changes are inherently risky, but changes that cannot be undone can be potentially catastrophic. Change procedures that allow you to effectively turn back time through a <em>rollback</em> make enhancements and experimentation safer. Blue/green deployments give you a method to quickly retract the changes if things go wrong. In this deployment strategy, you create an environment for the new version. This environment is identical to the current version of the application being updated. Once the new environment is provisioned, traffic is routed to the new environment. If the new version produces the desired results without generating errors, the old environment is terminated. Otherwise, traffic is restored to the old version. </p>
<p>You can perform blue/green deployments in Kubernetes by creating a new Deployment that is identical to the existing version’s Deployment. Once you verify that the Pods in the new Deployment are running without errors, you can start sending traffic to the new Deployment by changing the <code>selector</code> spec in the Service that routes traffic to your application’s Pods.</p>
<p>Many continuous integration tools such as <a href="https://fluxcd.io">Flux</a>, <a href="https://www.jenkins.io">Jenkins</a>, and <a href="https://spinnaker.io">Spinnaker</a> let you automate blue/green deployments. Kubernetes blog includes a walkthrough using Jenkins: <a href="https://kubernetes.io/blog/2018/04/30/zero-downtime-deployment-kubernetes-jenkins/">Zero-downtime Deployment in Kubernetes with Jenkins</a></p>
<h3 id="use-canary-deployments">Use Canary deployments<a class="headerlink" href="#use-canary-deployments" title="Permanent link">&para;</a></h3>
<p>Canary deployments are a variant of blue/green deployments that can significantly remove risk from changes. In this deployment strategy, you create a new Deployment with fewer Pods alongside your old Deployment, and divert a small percentage of traffic to the new Deployment. If metrics indicate that the new version is performing as well or better than the existing version, you progressively increase traffic to the new Deployment while scaling it up until all traffic is diverted to the new Deployment. If there's an issue, you can route all traffic to the old Deployment and stop sending traffic to the new Deployment.</p>
<p>Although Kubernetes offers no native way to perform canary deployments, you can use tools such as <a href="https://github.com/weaveworks/flagger">Flagger</a> with <a href="https://docs.flagger.app/tutorials/istio-progressive-delivery">Istio</a> or <a href="https://docs.flagger.app/install/flagger-install-on-eks-appmesh">App Mesh</a>.</p>
<h2 id="health-checks-and-self-healing">Health checks and self-healing<a class="headerlink" href="#health-checks-and-self-healing" title="Permanent link">&para;</a></h2>
<p>No software is bug-free, but Kubernetes can help you to minimize the impact of software failures. In the past, if an application crashed, someone had to remediate the situation by restarting the application manually. Kubernetes gives you the ability to detect software failures in your Pods and automatically replace them with new replicas. With Kubernetes you can monitor the health of your applications and automatically replace unhealthy instances.  </p>
<p>Kubernetes supports three types of <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">health-checks</a>:</p>
<ol>
<li>Liveness probe</li>
<li>Startup probe (supported in Kubernetes version 1.16+)</li>
<li>Readiness probe</li>
</ol>
<p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">Kubelet</a>, the Kubernetes agent, is responsible for running all the above-mentioned checks. Kubelet can check a Pods' health in three ways: kubelet can either run a shell command inside a Pod's container, send an HTTP GET request to its container, or open a TCP socket on a specified port.  </p>
<p>If you choose an <code>exec</code>-based probe, which runs a shell script inside a container, ensure that the shell command exits <em>before</em> the <code>timeoutSeconds</code> value expires. Otherwise, your node will have <code>&lt;defunct&gt;</code> processes, leading to node failure. </p>
<h2 id="recommendations_1">Recommendations<a class="headerlink" href="#recommendations_1" title="Permanent link">&para;</a></h2>
<h3 id="use-liveness-probe-to-remove-unhealthy-pods">Use Liveness Probe to remove unhealthy pods<a class="headerlink" href="#use-liveness-probe-to-remove-unhealthy-pods" title="Permanent link">&para;</a></h3>
<p>The Liveness probe can detect <em>deadlock</em> conditions where the process continues to run, but the application becomes unresponsive. For example, if you are running a web service that listens on port 80, you can configure a Liveness probe to send an HTTP GET request on Pod’s port 80. Kubelet will periodically send a GET request to the Pod and expect a response; if the Pod responds between 200-399 then the kubelet considers that Pod is healthy; otherwise, the Pod will be marked as unhealthy. If a Pod fails health-checks continuously, the kubelet will terminate it. </p>
<p>You can use <code>initialDelaySeconds</code> to delay the first probe.</p>
<p>When using the Liveness Probe, ensure that your application doesn’t run into a situation in which all Pods simultaneously fail the Liveness Probe because Kubernetes will try to replace all your Pods, which will render your application offline. Furthermore, Kubernetes will continue to create new Pods that will also fail Liveness Probes, putting unnecessary strain on the control plane. Avoid configuring the Liveness Probe to depend on an a factor that is external to your Pod, for example, a external database. In other words, a non-responsive external-to-your-Pod database shouldn’t make your Pods fail their Liveness Probes.</p>
<p>Sandor Szücs’s post <a href="https://srcco.de/posts/kubernetes-liveness-probes-are-dangerous.html">LIVENESS PROBES ARE DANGEROUS</a> describes problems that can be caused by misconfigured probes.</p>
<h3 id="use-startup-probe-for-applications-that-take-longer-to-start">Use Startup Probe for applications that take longer to start<a class="headerlink" href="#use-startup-probe-for-applications-that-take-longer-to-start" title="Permanent link">&para;</a></h3>
<p>When your app needs additional time to startup, you can use the Startup Probe to delay the Liveness and Readiness Probe. For example, a Java app that needs to hydrate cache from a database may need up to two minutes before it is fully functional. Any Liveness or Readiness Probe until it becomes fully functional might fail. Configuring a Startup Probe will allow the Java app to become <em>healthy</em> before Liveness or Readiness Probe are executed. </p>
<p>Until the Startup Probe succeeds, all the other Probes are disabled. You can define the maximum time Kubernetes should wait for application startup. If, after the maximum configured time, the Pod still fails Startup Probes, it will be terminated, and a new Pod will be created. </p>
<p>The Startup Probe is similar to the Liveness Probe -- if they fail, the Pod is recreated. As Ricardo A. explains in his post <a href="https://medium.com/swlh/fantastic-probes-and-how-to-configure-them-fef7e030bd2f">Fantastic Probes And How To Configure Them</a>, Startup Probes should be used when the startup time of an application is unpredictable. If you know your application needs ten seconds to start, use should use Liveness/Readiness Probe with <code>initialDelaySeconds</code> instead.</p>
<h3 id="use-readiness-probe-to-detect-partial-unavailability">Use Readiness Probe to detect partial unavailability<a class="headerlink" href="#use-readiness-probe-to-detect-partial-unavailability" title="Permanent link">&para;</a></h3>
<p>While the Liveness probe detects failures in an app that are resolved by terminating the Pod (hence, restarting the app), Readiness Probe detects conditions where the app may be <em>temporarily</em> unavailable. In these situations, the app may become temporarily unresponsive; however, it is expected to be healthy again once this operation completes.  </p>
<p>For example, during intense disk I/O operations, applications may be temporarily unavailable to handle requests. Here, terminating the application’s Pod is not a remedy; at the same time, additional requests sent to the Pod can fail. </p>
<p>You can use the Readiness Probe to detect temporary unavailability in your app and stop sending requests to its Pod until it becomes functional again. <em>Unlike Liveness Probe, where a failure would result in a recreation of Pod, a failed Readiness Probe would mean that Pod will not receive any traffic from Kubernetes Service</em>. When the Readiness Probe succeeds, Pod will resume receiving traffic from Service. </p>
<p>Just like the Liveness Probe, avoid configuring Readiness Probes that depend on a resource that’s external to the Pod (such as a database). Here’s a scenario where a poorly configured Readiness can render the application nonfunctional - if a Pod’s Readiness Probe fails when the app’s database is unreachable, other Pod replicas will also fail simultaneously since they share the same health-check criteria. Setting the probe in this way will ensure that whenever the database is unavailable, the Pod’s Readiness Probes will fail, and Kubernetes will stop sending traffic <em>all</em> Pods.  </p>
<p>A side-effect of using Readiness Probes is that they can increase the time it takes to update Deployments. New replicas will not receive traffic unless Readiness Probes are successful; until then, old replicas will continue to receive traffic. </p>
<hr />
<h2 id="dealing-with-disruptions">Dealing with disruptions<a class="headerlink" href="#dealing-with-disruptions" title="Permanent link">&para;</a></h2>
<p>Pods have a finite lifetime - even if you have long-running Pods, it’s prudent to ensure Pods terminate correctly when the time comes. Depending on your upgrade strategy, Kubernetes cluster upgrades may require you to create new worker nodes, which requires all Pods to be recreated on newer nodes. Proper termination handling and Pod Disruption Budgets can help you avoid service disruptions as Pods are removed from older nodes and recreated on newer nodes.  </p>
<p>The preferred way to upgrade worker nodes is by creating new worker nodes and terminating old ones. Before terminating worker nodes, you should <code>drain</code> it. When a worker node is drained, all its pods are <em>safely</em> evicted. Safely is a key word here; when pods on a worker are evicted, they are not simply sent a <code>SIGKILL</code> signal. Instead, a <code>SIGTERM</code> signal is sent to the main process (PID 1) of each container in the Pods being evicted. After the <code>SIGTERM</code> signal is sent, Kubernetes will give the process some time (grace period) before a <code>SIGKILL</code> signal is sent. This grace period is 30 seconds by default; you can override the default by using <code>grace-period</code> flag in kubectl or declare <code>terminationGracePeriodSeconds</code> in your Podspec.</p>
<p><code>kubectl delete pod &lt;pod name&gt; —grace-period=&lt;seconds&gt;</code></p>
<p>It is common to have containers in which the main process doesn’t have PID 1. Consider this Python-based sample container:</p>
<div class="codehilite"><pre><span></span><code>$ kubectl <span class="nb">exec</span> python-app -it ps
 PID USER TIME COMMAND
 <span class="m">1</span>   root <span class="m">0</span>:00 <span class="o">{</span>script.sh<span class="o">}</span> /bin/sh ./script.sh
 <span class="m">5</span>   root <span class="m">0</span>:00 python app.py
</code></pre></div>

<p>In this example, the shell script receives <code>SIGTERM</code>, the main process, which happens to be a Python application in this example, doesn’t get a <code>SIGTERM</code> signal. When the Pod is terminated, the Python application will be killed abruptly. This can be remediated by changing the <a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a> of the container to launch the Python application. Alternatively, you can use a tool like <a href="https://github.com/Yelp/dumb-init">dumb-init</a> to ensure that your application can handle signals.  </p>
<p>You can also use <a href="https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#container-hooks">Container hooks</a> to execute a script or an HTTP request at container start or stop. The <code>PreStop</code> hook action runs when the container receives a <code>SIGTERM</code> signal and is killed after <code>terminationGracePeriodSeconds</code>. </p>
<h2 id="recommendations_2">Recommendations<a class="headerlink" href="#recommendations_2" title="Permanent link">&para;</a></h2>
<h3 id="protect-critical-workload-with-pod-disruption-budgets">Protect critical workload with Pod Disruption Budgets<a class="headerlink" href="#protect-critical-workload-with-pod-disruption-budgets" title="Permanent link">&para;</a></h3>
<p>Pod Disruption Budget or PDB can temporarily halt the eviction process if the number of replicas of an application falls below the declared threshold. The eviction process will continue once the number of available replicas is over the threshold. You can use PDB to declare the <code>minAvailable</code> and <code>maxUnavailable</code> number of replicas. For example, if you want at least three copies of your app to be available, you can create a PDB. </p>
<div class="codehilite"><pre><span></span><code><span class="n">apiVersion</span><span class="o">:</span> <span class="n">policy</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">PodDisruptionBudget</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">my</span><span class="o">-</span><span class="n">svc</span><span class="o">-</span><span class="n">pdb</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">minAvailable</span><span class="o">:</span> <span class="mi">3</span>
  <span class="n">selector</span><span class="o">:</span>
    <span class="n">matchLabels</span><span class="o">:</span>
      <span class="n">app</span><span class="o">:</span> <span class="n">my</span><span class="o">-</span><span class="n">svc</span>
</code></pre></div>

<p>The above PDB policy tells Kubernetes to halt the eviction process until three or more replicas are available. Node draining respects <code>PodDisruptionBudgets</code>. During an EKS managed node group upgrade, <a href="https://docs.aws.amazon.com/eks/latest/userguide/managed-node-update-behavior.html">nodes are drained with a fifteen-minute timeout</a>. After fifteen minutes, if the update is not forced (the option is called Rolling update in the EKS console), the update fails. If the update is forced, the pods are deleted.</p>
<p>For self-managed nodes, you can also use tools like <a href="https://github.com/aws/aws-node-termination-handler">AWS Node Termination Handler</a>, which ensures that the Kubernetes control plane responds appropriately to events that can cause your EC2 instance to become unavailable, such as <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-instances-status-check_sched.html">EC2 maintenance</a> events and <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-interruptions.html">EC2 Spot interruptions</a>. It uses the Kubernetes API to cordon the node to ensure no new Pods are scheduled, then drains it, terminating any running Pods.</p>
<p>You can use Pod anti-affinity to schedule a Deployment‘s Pods on different nodes and avoid PDB related delays during node upgrades. </p>
<h3 id="practice-chaos-engineering">Practice chaos engineering<a class="headerlink" href="#practice-chaos-engineering" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Chaos Engineering is the discipline of experimenting on a distributed system in order to build confidence in the system’s capability to withstand turbulent conditions in production.</p>
</blockquote>
<p>In his blog, Dominik Tornow explains that <a href="https://medium.com/@dominik.tornow/the-mechanics-of-kubernetes-ac8112eaa302">Kubernetes is a declarative system</a> where “<em>the user supplies a representation of the desired state of the system to the system. The system then considers the current state and the desired state to determine the sequence of commands to transition from the current state to the desired state.</em>” This means Kubernetes always stores the <em>desired state</em> and if the system deviates, Kubernetes will take action to restore the state. For example, if a worker node becomes unavailable, Kubernetes will reschedule the Pods onto another worker node. Similarly, if a <code>replica</code> crashes, the <a href="https://kubernetes.io/docs/concepts/architecture/controller/#design">Deployment Contoller</a> will create a new <code>replica</code>. In this way, Kubernetes controllers automatically fix failures. </p>
<p>Chaos engineering tools like <a href="https://www.gremlin.com">Gremlin</a> help you test the resiliency of your Kubernetes cluster and identify single points of failure. Tools that introduce artificial chaos in your cluster (and beyond) can uncover systemic weaknesses, present an opportunity to identify  bottlenecks and misconfigurations, and rectify problems in a controlled environment. The Chaos Engineering philosophy advocates breaking things on purpose and stress testing infrastructure to minimize unanticipated downtime. </p>
<h3 id="use-a-service-mesh">Use a Service Mesh<a class="headerlink" href="#use-a-service-mesh" title="Permanent link">&para;</a></h3>
<p>You can use a service mesh to improve your application’s resiliency. Service meshes enable service-to-service communication and increase the observability of your microservices network. Most service mesh products work by having a small network proxy run alongside each service that intercepts and inspects the application’s network traffic. You can place your application in a mesh without modifying your application. Using service proxy’s built-in features, you can have it generate network statistics, create access logs, and add HTTP headers to outbound requests for distributed tracing.</p>
<p>A service mesh can help you make your microservices more resilient with features like automatic request retries, timeouts, circuit-breaking, and rate-limiting.</p>
<p>If you operate multiple clusters, you can use a service mesh to enable cross-cluster service-to-service communication.</p>
<h3 id="service-meshes">Service Meshes<a class="headerlink" href="#service-meshes" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://aws.amazon.com/app-mesh/">AWS App Mesh</a></li>
<li><a href="https://istio.io">Istio</a></li>
<li><a href="http://linkerd.io">LinkerD</a></li>
<li><a href="https://www.consul.io">Consul</a></li>
</ul>
<hr />
<h2 id="observability">Observability<a class="headerlink" href="#observability" title="Permanent link">&para;</a></h2>
<p>Observability is an umbrella term that includes monitoring, logging, and tracing. Microservices based applications are distributed by nature. Unlike monolithic applications where monitoring a single system is sufficient, in a distributed application architecture, you need to monitor each component’s performance. You can use cluster-level monitoring, logging, and distributed tracing systems to identify issues in your cluster before they disrupt your customers. </p>
<p>Kubernetes built-in tools for troubleshooting and monitoring are limited. The metrics-server collects resource metrics and stores them in memory but doesn’t persist them. You can view the logs of a Pod using kubectl, but Kubernetes doesn't automatically retain logs. And the implementation of distributed tracing is done either at the application code level or using services meshes. </p>
<p>Kubernetes' extensibility shines here. Kubernetes allows you to bring your preferred centralized monitoring, logging, and tracing solution. </p>
<h2 id="recommendations_3">Recommendations<a class="headerlink" href="#recommendations_3" title="Permanent link">&para;</a></h2>
<h3 id="monitor-your-applications">Monitor your applications<a class="headerlink" href="#monitor-your-applications" title="Permanent link">&para;</a></h3>
<p>The number of metrics you need to monitor in modern applications is growing continuously. It helps if you have an automated way to track your applications so you can focus on solving your customer’s challenges. Cluster-wide monitoring tools like <a href="https://prometheus.io">Prometheus</a> or <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html">CloudWatch Container Insights</a> can monitor your cluster and workload and provide you signals when, or preferably, before things go wrong. </p>
<p>Monitoring tools allow you to create alerts that your operations team can subscribe to. Consider rules to activate alarms for events that can, when exacerbated, lead to an outage or impact application performance. </p>
<p>If you’re unclear on which metrics you should monitor, you can take inspiration from these methods:</p>
<ul>
<li><a href="https://www.weave.works/docs/cloud/latest/tasks/monitor/best-instrumenting/">RED method</a>. Stands for requests, errors, and duration. </li>
<li><a href="http://www.brendangregg.com/usemethod.html">USE method</a>. Stands for utilization, saturation, and errors.  </li>
</ul>
<p>Sysdig’s post <a href="https://sysdig.com/blog/alerting-kubernetes/">Best practices for alerting on Kubernetes</a> includes a comprehensive list of components that can impact the availability of your applications.</p>
<h3 id="use-prometheus-client-library-to-expose-application-metrics">Use Prometheus client library to expose application metrics<a class="headerlink" href="#use-prometheus-client-library-to-expose-application-metrics" title="Permanent link">&para;</a></h3>
<p>In addition to monitoring the state of the application and aggregating standard metrics, you can also use the <a href="https://prometheus.io/docs/instrumenting/clientlibs/">Prometheus client library</a> to expose application-specific custom metrics to improve the application's observability.</p>
<h3 id="use-centralized-logging-tools-to-collect-and-persist-logs">Use centralized logging tools to collect and persist logs<a class="headerlink" href="#use-centralized-logging-tools-to-collect-and-persist-logs" title="Permanent link">&para;</a></h3>
<p>Logging in EKS falls under two categories: control plane logs and application logs. EKS control plane logging provides audit and diagnostic logs directly from the control plane to CloudWatch Logs in your account. Application logs are logs produced by Pods running inside your cluster. Application logs include logs produced by Pods that run the business logic applications and Kubernetes system components such as CoreDNS, Cluster Autoscaler, Prometheus, etc. </p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html">EKS provide five types of control plane logs</a>:</p>
<ol>
<li>Kubernetes API server component logs</li>
<li>Audit</li>
<li>Authenticator</li>
<li>Controller manager </li>
<li>Scheduler</li>
</ol>
<p>The controller manager and scheduler logs can help diagnose control plane problems such as bottlenecks and errors. By default, EKS control plane logs aren’t sent to CloudWatch Logs. You can enable control plane logging and select the types of EKS control plane logs you’d like to capture for each cluster in your account</p>
<p>Collecting application logs requires installing a log aggregator tool like <a href="http://fluentbit.io">Fluent Bit</a>, <a href="https://www.fluentd.org">Fluentd</a>, or <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html">CloudWatch Container Insights</a> in your cluster.  </p>
<p>Kubernetes log aggregator tools run as DaemonSets and scrape container logs from nodes. Application logs are then sent to a centralized destination for storage. For example, CloudWatch Container Insights can use either Fluent Bit or Fluentd to collect logs and ship them to CloudWatch Logs for storage. Fluent Bit and Fluentd support many popular log analytics systems such as Elasticsearch and InfluxDB giving you the ability to change the storage backend for your logs by modifying Fluent bit or Fluentd’s log configuration. </p>
<h3 id="use-a-distributed-tracing-system-to-identify-bottlenecks">Use a distributed tracing system to identify bottlenecks<a class="headerlink" href="#use-a-distributed-tracing-system-to-identify-bottlenecks" title="Permanent link">&para;</a></h3>
<p>A typical modern application has components distributed over the network, and its reliability depends on the proper functioning of each of the components that make up the application. You can use a distributed tracing solution to understand how requests flow and how systems communicate. Traces can show you where bottlenecks exist in your application network and prevent problems that can cause cascading failures. </p>
<p>You have two options to implement tracing in your applications: you can either implement distributed tracing at the code level using shared libraries or use a service mesh. </p>
<p>Implementing tracing at the code level can be disadvantageous. In this method, you have to make changes to your code. This is further complicated if you have polyglot applications. You’re also responsible for maintaining yet another library, across your services. </p>
<p>Service Meshes like <a href="http://linkerd.io">LinkerD</a>, <a href="http://istio.io">Istio</a>, and <a href="https://aws.amazon.com/app-mesh/">AWS App Mesh</a> can be used to implement distributed tracing in your application with minimal changes to the application code. You can use service mesh to standardize metrics generation, logging, and tracing. </p>
<p>Tracing tools like <a href="https://aws.amazon.com/xray/">AWS X-Ray</a>, <a href="https://www.jaegertracing.io">Jaeger</a> support both shared library and service mesh implementations. </p>
<p>Consider using a tracing tool like <a href="https://aws.amazon.com/xray/">AWS X-Ray</a> or <a href="https://www.jaegertracing.io">Jaeger</a> that supports both (shared library and service mesh) implementations so you will not have to switch tools if you later adopt service mesh. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        <a href="../controlplane/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Control Plane
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>